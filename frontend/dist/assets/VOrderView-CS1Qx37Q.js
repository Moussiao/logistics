import{d as h,b as p,h as a,t as f,r as O,o as c,i as g,e as i,w as V,u as B,E as F,j as S,F as E,k as H,l as q,m as P,n as I,p as L,q as k,c as A,a as R,X,s as z,v as w,x as C,y as N,T as J,z as W,A as G,B as K,C as Q,D as Y}from"./index-DPe8PrNa.js";import{g as Z,a as ee,_ as te,b as se,i as ae,e as oe,u as M,o as re,c as ne,w as le,V as de,t as ie,d as ue,f as ce}from"./orders-BbEAdbwa.js";const me={class:"VOrderDetailBlock flex flex-col gap-2 rounded px-2 py-2"},pe={class:"flex items-center"},fe={class:"font-bold text-lg flex-auto"},he={class:"flex flex-col gap-2"},b=h({__name:"VOrderDetailBlock",props:{name:{}},setup(n){return(s,r)=>(c(),p("div",me,[a("div",pe,[a("span",fe,f(s.name),1),O(s.$slots,"right-header")]),a("div",he,[O(s.$slots,"default")])]))}}),_e={class:"VOrderDetailBlockField flex flex-col"},ve={class:"flex flex-col"},ye={class:"VOrderDetailBlockField__Name text-sm"},x=h({__name:"VOrderDetailBlockField",props:{name:{},value:{}},setup(n){return(s,r)=>(c(),p("div",_e,[a("div",ve,[a("span",ye,f(s.name),1),a("span",null,f(s.value),1)])]))}}),xe={class:"VOrderDetail rounded flex flex-col gap-2"},Ve={class:"flex flex-col gap-1"},ge={class:"flex flex-col flex-auto"},Be={class:"VOrderDetail__Hint"},we={class:"flex flex-col text-right"},$e={class:"VOrderDetail__Hint"},De={class:"flex items-center"},ke={class:"font-bold text-xl"},Oe=h({__name:"VOrderDetail",props:{order:{}},emits:["onClickEditOrder"],setup(n){const s=n,r=g(()=>{if(!s.order.customerAddress)return"-";const e=s.order.customerAddress,l=[];return e.postcode&&l.push(e.postcode),e.regionName&&l.push(e.regionName),e.cityName&&l.push(e.cityName),l.join(", ")||"-"}),o=g(()=>{if(!(s.order.customerAddress&&s.order.customerAddress.street))return"-";const e=s.order.customerAddress;return`${e.street} д. ${e.houseNumber} кв. ${e.flatNumber}`});return(e,l)=>(c(),p("div",xe,[i(b,{name:"Детали заказа"},{"right-header":V(()=>[a("button",{type:"button",title:"Изменить",onClick:l[0]||(l[0]=S(t=>e.$emit("onClickEditOrder"),["stop","prevent"])),class:"VOrderDetail__Edit"},[i(B(F))])]),default:V(()=>{var t,u;return[i(x,{name:"Имя заказчика",value:((t=e.order.customer)==null?void 0:t.name)||"-"},null,8,["value"]),i(x,{name:"Телефон заказчика",value:((u=e.order.customer)==null?void 0:u.phone)||"-"},null,8,["value"]),i(x,{name:"Комментарий",value:e.order.comment||"-"},null,8,["value"])]}),_:1}),i(b,{name:"Адрес доставки"},{default:V(()=>{var t;return[i(x,{name:"Населенный пункт",value:r.value},null,8,["value"]),i(x,{name:"Улица",value:o.value},null,8,["value"]),i(x,{name:"Комментарий к доставке",value:((t=e.order.customerAddress)==null?void 0:t.comment)||"-"},null,8,["value"])]}),_:1}),i(b,{name:"Товары"},{default:V(()=>[a("div",Ve,[(c(!0),p(E,null,H(e.order.products,t=>(c(),p("div",{key:t.productId,class:"flex"},[a("div",ge,[a("span",null,f(t.productName),1),a("span",Be,f(t.quantity)+" шт",1)]),a("div",we,[a("span",null,f(+t.totalPrice),1),a("span",$e,f(+(t.totalPrice/(t.quantity||1)).toFixed(2))+"/шт ",1)])]))),128))]),a("div",De,[l[1]||(l[1]=a("span",{class:"font-bold text-xl flex-auto"},"Итого",-1)),a("span",ke,f(+e.order.totalPrice),1)])]),_:1})]))}});var be=q();const T=P(be);T.locale("ru");const Ce=(n,s)=>T(n).format(s),Me={class:"VOrderHeader rounded px-2 py-2"},Ae={class:"flex items-center"},Ie={class:"font-bold text-2xl flex-auto"},Se={class:"font-bold"},Ee=h({__name:"VOrderHeader",props:{order:{}},setup(n){const s=n,r=g(()=>Z(s.order)),o=g(()=>Ce(s.order.stateChangedAt,"D MMM HH:mm")),e=g(()=>ee(s.order.state));return(l,t)=>(c(),p("div",Me,[a("div",Ae,[a("span",Ie,f(r.value),1),i(B(e))]),a("div",null,[a("span",Se,f(o.value),1)])]))}}),Le={key:0,class:"VTextInput__Title text-sm"},Ne={class:"VTextInput flex items-center rounded-r rounded-bl w-full px-2"},Te=["type","placeholder","name","autocomplete","inputmode","value"],je=h({__name:"VTextInput",props:I({type:{default:"text"},placeholder:{default:""},autocomplete:{},title:{},name:{},inputmode:{default:"text"},leftIcon:{},hasCleaner:{type:Boolean,default:!0}},{modelValue:{required:!0},modelModifiers:{}}),emits:I(["update:modelValue"],["update:modelValue"]),setup(n,{emit:s}){const r=L(n,"modelValue"),o=s,e=t=>{const m=t.target.value;o("update:modelValue",m||"")},l=()=>{o("update:modelValue",null)};return(t,u)=>(c(),p("div",null,[t.title?(c(),p("span",Le,f(t.title),1)):k("",!0),a("div",Ne,[t.leftIcon?(c(),A(R(t.leftIcon),{key:0})):k("",!0),a("input",{type:t.type,placeholder:t.placeholder,name:t.name,autocomplete:t.autocomplete,inputmode:t.inputmode,value:r.value,class:"p-2.5 w-full",onInput:e},null,40,Te),t.hasCleaner&&r.value?(c(),p("button",{key:1,type:"button",title:"Очистить",onClick:S(l,["stop","prevent"])},[i(B(X))])):k("",!0)])]))}}),Ue=te(je,[["__scopeId","data-v-f72b41ec"]]);function Fe(n,s){const r={};for(const o of Object.keys(n)){const e=n[o];s(e,o)&&(r[o]=e)}return r}const j=z("order",{state:()=>({id:-1,externalId:-1,externalVerbose:"",state:"",stateChangedAt:"",deliveryDate:"",expectedDeliveryDate:"",totalPrice:0,createdAt:"",updatedAt:"",comment:"",customer:void 0,customerAddress:void 0,products:[]}),actions:{async getData(n){try{const s=await se(n),{id:r,externalId:o,externalVerbose:e,state:l,stateChangedAt:t,deliveryDate:u,expectedDeliveryDate:m,totalPrice:_,createdAt:$,updatedAt:v,comment:d,customer:y,customerAddress:D,products:U}=s;this.id=r,this.externalId=o,this.externalVerbose=e,this.state=l,this.stateChangedAt=t,this.deliveryDate=u,this.expectedDeliveryDate=m,this.totalPrice=_,this.createdAt=$,this.updatedAt=v,this.comment=d,this.customer=y,this.customerAddress=D,this.products=U}catch{}},async setData(n){const s=Fe(n,(r,o)=>this[o]!==r);if(!ae(s))try{await oe(this.id,s)}catch{}}}}),He={class:"flex flex-col gap-2 px-2 pb-2"},qe=h({__name:"VOrderEdit",emits:["orderUpdated"],setup(n,{emit:s}){const r=s,o=j(),e=M(),l=w(!1),t=w(void 0);return C(t,()=>{l.value||t.value!==o.comment&&(e.showMainButton("Сохранить",async()=>{e.showMainButtonLoader(),await o.setData({comment:t.value||""}),e.hideMainButtonLoader(),r("orderUpdated")}),l.value=!0)}),N(()=>{t.value=o.comment}),(u,m)=>(c(),p("div",He,[i(Ue,{modelValue:t.value,"onUpdate:modelValue":m[0]||(m[0]=_=>t.value=_),title:"Комментарий",placeholder:"Введите комментарий к заказу"},null,8,["modelValue"])]))}}),Pe={key:0,class:"VBottomSheetWrapper flex items-end justify-center fixed left-0 top-0 h-full w-full"},Re={class:"VBottomSheet__Header"},Xe={class:"VBottomSheet__Body"},ze=h({__name:"VBottomSheet",props:{modelValue:{type:Boolean,required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(n){const s=w(null),r=L(n,"modelValue");return re(s,()=>r.value=!1),(o,e)=>(c(),A(W,{to:"body"},[i(J,{name:"bottom-sheet"},{default:V(()=>[r.value?(c(),p("div",Pe,[a("div",{ref_key:"target",ref:s,class:"VBottomSheet rounded-t w-full max-w-screen-sm overflow-y-auto grid gap-2"},[a("div",Re,[O(o.$slots,"header")]),a("div",Xe,[O(o.$slots,"default")])],512)])):k("",!0)]),_:3})]))}}),Je={class:"flex flex-col h-full"},We={key:0,class:"flex flex-col overflow-y-auto min-h-0 gap-2"},Qe=h({__name:"VOrderView",setup(n){const s=Y(),r=Q(),o=G(),e=j(),l=ne(),t=M(),u=w(!0),m=w(!1),_=g(()=>String(s.params.id)),$=()=>{if(o.role!=="partner")return;const d=M();e.state==="new"&&d.showMainButton("Взять в работу",()=>{d.openPopup({title:"Взять заказ в работу",message:"Вы точно хотите взять заказ в работу?",onActionButtonClick:async()=>{d.showMainButtonLoader(),await ie(e.id),await v(),d.hideMainButtonLoader()}})}),e.state==="processing"&&d.showMainButton("Отправиться к заказчику",()=>{d.openPopup({title:"Отправиться к заказчику",message:"Вы подтверждаете, что отправляетесь к заказчику?",onActionButtonClick:async()=>{d.showMainButtonLoader(),await ue(e.id),await v(),d.hideMainButtonLoader()}})}),e.state==="delivery"&&d.showMainButton("Заказ оплачен",()=>{d.openPopup({title:"Заказ оплачен",message:"Вы подтверждаете, что заказ оплачен?",onActionButtonClick:async()=>{d.showMainButtonLoader(),await ce(e.id),await v(),d.hideMainButtonLoader()}})})},v=async()=>{u.value=!0,m.value=!1,l.clean(),await e.getData(_.value),u.value=!1};return le(_,async d=>{u.value=!0,await e.getData(d),u.value=!1}),C(u,()=>{u.value?t.hideMainButton():$()}),C(m,d=>{d?t.showMainButton("Закрыть",()=>m.value=!1):u.value||(t.hideMainButton(),$())}),N(()=>{t.showBackButton(()=>{r.push({name:"orders"})})}),K(()=>{t.hideBackButton(),t.hideMainButton()}),(d,y)=>(c(),p(E,null,[a("div",Je,[u.value?(c(),A(de,{key:1,class:"px-2"})):(c(),p("div",We,[i(Ee,{order:B(e)},null,8,["order"]),i(Oe,{order:B(e),onOnClickEditOrder:y[0]||(y[0]=D=>m.value=!0)},null,8,["order"])]))]),i(ze,{modelValue:m.value,"onUpdate:modelValue":y[1]||(y[1]=D=>m.value=D)},{default:V(()=>[i(qe,{onOrderUpdated:v})]),_:1},8,["modelValue"])],64))}});export{Qe as default};
